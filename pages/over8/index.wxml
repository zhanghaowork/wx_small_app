<view class="page">
  <view class="section-title">è¶…8è½¬è§„åˆ™</view>
  <view class="card rule-card">
    <text>æ¯äººè·Ÿéšæœº8äººå„æ­æ¡£1æ¬¡ï¼Œè¿›è¡ŒåŒæ‰“æ¯”èµ›</text>
    <text>èµ›ç¨‹æŒ‰ä¸¤ç‰‡åœºåœ°å®‰æ’ï¼šæ¯è½®2åœºï¼Œå…± N è½®</text>
    <text>å…¶ä¸­ N ä¸ºæ€»äººæ•°ï¼Œåˆè®¡ 2N åœºæ¯”èµ›</text>
  </view>

  <view class="section-title">å‚èµ›äººå‘˜ï¼ˆ9-50äººï¼‰</view>
  <view class="card input-card">
    <view class="input-row">
      <input
        class="name-input"
        placeholder="è¾“å…¥é€‰æ‰‹å§“å"
        value="{{inputName}}"
        bindinput="onNameInput"
        bindconfirm="addPlayer"
      />
      <button class="add-btn" bindtap="addPlayer">æ·»åŠ </button>
    </view>

    <view class="actions">
      <button class="batch-btn" bindtap="showBatchInput">æ‰¹é‡å¯¼å…¥</button>
    </view>

    <scroll-view class="player-list" wx:if="{{players.length > 0}}" scroll-y>
      <view class="player-item" wx:for="{{players}}" wx:key="index">
        <text>{{index + 1}}. {{item}}</text>
        <text class="delete" data-index="{{index}}" bindtap="removePlayer">åˆ é™¤</text>
      </view>
    </scroll-view>
  </view>

  <view class="error" wx:if="{{errorText}}">{{errorText}}</view>

  <view class="batch-panel" wx:if="{{batchInputVisible}}">
    <view class="panel-mask" bindtap="hideBatchInput"></view>
    <view class="panel-body">
      <view class="panel-title">æ‰¹é‡å¯¼å…¥é€‰æ‰‹</view>
      <textarea
        class="panel-textarea"
        placeholder="æ¯è¡Œä¸€ä¸ªåå­—ï¼Œæˆ–ç”¨é€—å·åˆ†éš”"
        value="{{batchText}}"
        bindinput="onBatchTextInput"
      ></textarea>
      <view class="panel-actions">
        <button class="panel-cancel" bindtap="hideBatchInput">å–æ¶ˆ</button>
        <button class="panel-ok" bindtap="applyBatchInput">ç¡®è®¤å¯¼å…¥</button>
      </view>
    </view>
  </view>

  <view class="result" wx:if="{{rounds.length > 0}}">
    <view class="section-title">èµ›ç¨‹ç»“æœ</view>
    <view class="card summary">
      <text>äººæ•°ï¼š{{summary.totalPlayers}}</text>
      <text>è½®æ¬¡ï¼š{{summary.totalRounds}}</text>
      <text>æ€»åœºæ¬¡ï¼š{{summary.totalMatches}}</text>
      <text>æ¯è½®ï¼š2ç‰‡åœºåœ°å¹¶è¡Œ</text>
    </view>

    <view class="card round-card" wx:for="{{rounds}}" wx:key="round">
      <view class="round-title">ç¬¬ {{item.round}} è½®</view>
      <view class="court-line">1å·åœºï¼š{{item.court1.team1[0]}} / {{item.court1.team1[1]}} VS {{item.court1.team2[0]}} / {{item.court1.team2[1]}}</view>
      <view class="court-line">2å·åœºï¼š{{item.court2.team1[0]}} / {{item.court2.team1[1]}} VS {{item.court2.team2[0]}} / {{item.court2.team2[1]}}</view>
    </view>

    <view class="score-toolbar card">
      <text class="score-tip">ç‚¹å‡»æ¯”åˆ†å¯ä»¥ä¿®æ”¹</text>
      <view class="score-actions">
        <button class="toolbar-btn print-btn" bindtap="handlePrint">æ‰“å°</button>
        <button class="toolbar-btn share-btn" bindtap="handleShare">è½¬å‘</button>
      </view>
    </view>

    <view class="card score-card" wx:for="{{scoreMatches}}" wx:key="id">
      <view class="round-title">ç¬¬{{item.round}}è½® Â· {{item.court}}å·åœº</view>
      <view class="score-line">
        <view class="team-col">
          <text class="player-tag">{{item.team1[0]}}</text>
          <text class="player-tag">{{item.team1[1]}}</text>
        </view>
        <view class="score-center">
          <input class="score-input" type="number" data-index="{{index}}" data-team="1" value="{{item.score1}}" bindinput="onScoreInput" />
          <text class="vs-big">VS</text>
          <input class="score-input" type="number" data-index="{{index}}" data-team="2" value="{{item.score2}}" bindinput="onScoreInput" />
        </view>
        <view class="team-col">
          <text class="player-tag">{{item.team2[0]}}</text>
          <text class="player-tag">{{item.team2[1]}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="settlement" wx:if="{{resultReady}}">
    <view class="section-title">ç»“ç®—æ’åï¼ˆå·²å½•å…¥{{totalScoredMatches}}åœºï¼‰</view>
    <view class="card rank-card">
      <view class="rank-header">
        <text class="rank-col rank-col-rank">æ’å</text>
        <text class="rank-col rank-col-name">é€‰æ‰‹</text>
        <text class="rank-col">èƒœåœº</text>
        <text class="rank-col">å‡€èƒœ</text>
        <text class="rank-col">èƒœç‡</text>
      </view>
      <view class="rank-row {{index === 0 ? 'rank-top1' : (index === 1 ? 'rank-top2' : (index === 2 ? 'rank-top3' : ''))}}" wx:for="{{ranking}}" wx:key="name">
        <view class="rank-col rank-col-rank rank-rank-wrap">
          <text class="medal" wx:if="{{index === 0}}">ğŸ¥‡</text>
          <text class="medal" wx:if="{{index === 1}}">ğŸ¥ˆ</text>
          <text class="medal" wx:if="{{index === 2}}">ğŸ¥‰</text>
          <text class="rank-no">{{index + 1}}</text>
        </view>
        <text class="rank-col rank-col-name">{{item.name}}</text>
        <text class="rank-col rank-num">{{item.wins}}</text>
        <text class="rank-col rank-num">{{item.diff}}</text>
        <text class="rank-col rank-num">{{item.winRate}}%</text>
      </view>
    </view>
  </view>

  <view class="bottom-safe"></view>
  <view class="fixed-footer">
    <button class="generate-btn" bindtap="onPrimaryAction">{{rounds.length > 0 ? 'ç»“æŸæ¯”èµ›' : 'ç”Ÿæˆè¶…8è½¬èµ›ç¨‹'}}</button>
  </view>
</view>
