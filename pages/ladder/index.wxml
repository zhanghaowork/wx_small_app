<view class="page">
  <view class="section-title">æ“‚å°ä¿¡æ¯</view>
  <view class="card form-card">
    <view class="row">
      <text class="label">æ ‡é¢˜</text>
      <input class="value-input" placeholder="è¾“å…¥æ“‚å°èµ›æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰" value="{{title}}" bindinput="onTitleInput" />
    </view>
    <view class="divider"></view>
    <view class="row">
      <text class="label">æ¯”èµ›æ—¥æœŸ</text>
      <picker mode="date" value="{{matchDate}}" bindchange="onDateChange">
        <view class="picker-text">{{matchDate || 'é€‰æ‹©æ¯”èµ›æ—¥æœŸ'}}</view>
      </picker>
    </view>
  </view>

  <view class="section-title">æ“‚ä¸»ç»„åˆï¼ˆå›ºå®šï¼‰</view>
  <view class="card player-card">
    <view class="pair-row">
      <input class="player-input" placeholder="æ“‚ä¸»A" data-field="p1" value="{{defender.p1}}" bindinput="onDefenderInput" />
      <text class="pair-vs">+</text>
      <input class="player-input" placeholder="æ“‚ä¸»B" data-field="p2" value="{{defender.p2}}" bindinput="onDefenderInput" />
    </view>
  </view>

  <view class="section-title">æ”»æ“‚ç»„åˆï¼ˆæœ€å¤š10ç»„ï¼‰</view>
  <view class="card challenger-card">
    <view class="challenger-actions">
      <button class="batch-btn" bindtap="showBatchInput">æ‰¹é‡å¯¼å…¥</button>
      <button class="add-btn" bindtap="addChallenger">æ–°å¢æ”»æ“‚ç»„</button>
    </view>
    <view class="pair-row challenger-row" wx:for="{{challengers}}" wx:key="id">
      <input class="player-input" placeholder="æ”»æ“‚A" data-index="{{index}}" data-field="p1" value="{{item.p1}}" bindinput="onChallengerInput" />
      <text class="pair-vs">+</text>
      <input class="player-input" placeholder="æ”»æ“‚B" data-index="{{index}}" data-field="p2" value="{{item.p2}}" bindinput="onChallengerInput" />
      <button class="delete-btn" size="mini" data-index="{{index}}" bindtap="removeChallenger">åˆ é™¤</button>
    </view>
  </view>

  <view class="batch-panel" wx:if="{{batchInputVisible}}">
    <view class="panel-mask" bindtap="hideBatchInput"></view>
    <view class="panel-body">
      <view class="panel-title">æ‰¹é‡å¯¼å…¥æ“‚å°åå•</view>
      <textarea
        class="panel-textarea"
        placeholder="{{batchPlaceholder}}"
        value="{{batchText}}"
        bindinput="onBatchTextInput"
      ></textarea>
      <view class="panel-actions">
        <button class="panel-cancel" bindtap="hideBatchInput">å–æ¶ˆ</button>
        <button class="panel-ok" bindtap="applyBatchInput">ç¡®è®¤å¯¼å…¥</button>
      </view>
    </view>
  </view>

  <view class="section-title">æ¯”åˆ†è®°å½•</view>
  <view class="card score-card">
    <view class="score-row head">
      <text class="col col-match">å¯¹é˜µ</text>
      <text class="col col-score">æ“‚ä¸»</text>
      <text class="col col-score">æ”»æ“‚</text>
    </view>

    <view class="score-row" wx:for="{{challengers}}" wx:key="id">
      <view class="col col-match match-text">
        <text>{{defender.p1 || 'æ“‚ä¸»A'}}/{{defender.p2 || 'æ“‚ä¸»B'}}</text>
        <text class="vs">VS</text>
        <text>{{item.p1 || 'æ”»æ“‚A'}}/{{item.p2 || 'æ”»æ“‚B'}}</text>
      </view>
      <input class="col col-score score-input" type="number" data-index="{{index}}" data-field="scoreDef" value="{{item.scoreDef}}" bindinput="onScoreInput" />
      <input class="col col-score score-input" type="number" data-index="{{index}}" data-field="scoreCha" value="{{item.scoreCha}}" bindinput="onScoreInput" />
    </view>
  </view>

  <view class="error" wx:if="{{errorText}}">{{errorText}}</view>

  <view class="settlement" wx:if="{{resultReady}}">
    <view class="section-title">ç»“ç®—ç»“æœ</view>
    <view class="card summary-card">
      <text>å·²å½•å…¥åœºæ¬¡ï¼š{{settlement.totalMatches}}</text>
      <text>æ“‚ä¸»èƒœåœºï¼š{{settlement.defenderWins}}</text>
      <text>æ“‚ä¸»è´Ÿåœºï¼š{{settlement.defenderLosses}}</text>
    </view>

    <view class="card rank-card">
      <view class="rank-header">
        <text class="rank-col rank-col-rank">æ’å</text>
        <text class="rank-col rank-col-name">ç»„åˆ</text>
        <text class="rank-col">èƒœåœº</text>
        <text class="rank-col">å‡€èƒœ</text>
        <text class="rank-col">èƒœç‡</text>
      </view>
      <view class="rank-row {{index === 0 ? 'rank-top1' : (index === 1 ? 'rank-top2' : (index === 2 ? 'rank-top3' : ''))}}" wx:for="{{ranking}}" wx:key="name">
        <view class="rank-col rank-col-rank rank-rank-wrap">
          <text class="medal" wx:if="{{index === 0}}">ğŸ¥‡</text>
          <text class="medal" wx:if="{{index === 1}}">ğŸ¥ˆ</text>
          <text class="medal" wx:if="{{index === 2}}">ğŸ¥‰</text>
          <text class="rank-no">{{index + 1}}</text>
        </view>
        <text class="rank-col rank-col-name">{{item.name}}</text>
        <text class="rank-col rank-num">{{item.wins}}</text>
        <text class="rank-col rank-num">{{item.diff}}</text>
        <text class="rank-col rank-num">{{item.winRate}}%</text>
      </view>
    </view>
  </view>

  <view class="bottom-safe"></view>
  <view class="fixed-footer">
    <button class="generate-btn" bindtap="onPrimaryAction">ç»“ç®—æ“‚å°</button>
  </view>
</view>
