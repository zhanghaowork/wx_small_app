<view class="page">
  <view class="section-title">无与伦比规则</view>
  <view class="card rule-card">
    <text>开局：1号+2号上场，从 0:0 开始</text>
    <text>接力：到达 K、2K、3K...N*K 分时，双方同时换人</text>
    <text>换人模式：当前组合前者下，下一位上；形成连续双人组合</text>
  </view>

  <view class="section-title">参数设置</view>
  <view class="card config-card">
    <view class="config-row">
      <text class="label">每队人数 N</text>
      <view class="stepper">
        <button class="step-btn" bindtap="decreaseTeamSize">-</button>
        <text class="step-value">{{teamSize}}</text>
        <button class="step-btn" bindtap="increaseTeamSize">+</button>
      </view>
    </view>

    <view class="config-row">
      <text class="label">每段分值 K</text>
      <view class="score-options">
        <view class="option {{scoreStep === 10 ? 'active' : ''}}" data-value="10" bindtap="selectScoreStep">10分制</view>
        <view class="option {{scoreStep === 15 ? 'active' : ''}}" data-value="15" bindtap="selectScoreStep">15分制</view>
      </view>
    </view>
  </view>

  <view class="section-title">队伍顺序（可选）</view>
  <view class="card input-card">
    <text class="hint">每队请输入 {{teamSize}} 人，按 1-N 顺序。留空将用 A1..AN / B1..BN 默认编号。</text>

    <text class="input-label">A队名单</text>
    <textarea class="textarea" placeholder="示例：张三 李四 王五..." value="{{teamAInput}}" bindinput="onTeamAInput"></textarea>

    <text class="input-label">B队名单</text>
    <textarea class="textarea" placeholder="示例：赵一 钱二 孙三..." value="{{teamBInput}}" bindinput="onTeamBInput"></textarea>
  </view>

  <view class="error" wx:if="{{errorText}}">{{errorText}}</view>

  <view class="result" wx:if="{{segments.length > 0}}">
    <view class="section-title">接力排表</view>
    <view class="card summary">
      <text>每队人数：{{summary.teamSize}}</text>
      <text>每段分值：{{summary.scoreStep}}</text>
      <text>目标分值：{{summary.targetScore}}</text>
      <text>接力段数：{{segments.length}}</text>
    </view>

    <view class="card segment-card" wx:for="{{segments}}" wx:key="id">
      <view class="seg-title">第{{item.id}}段（{{item.from}} - {{item.to}}分）</view>
      <view class="seg-line">A队：{{item.pairA[0]}} + {{item.pairA[1]}}</view>
      <view class="seg-line">B队：{{item.pairB[0]}} + {{item.pairB[1]}}</view>
    </view>

    <view class="card swap-card" wx:if="{{swaps.length > 0}}">
      <view class="swap-title">换人节点</view>
      <view class="swap-item" wx:for="{{swaps}}" wx:key="score">
        <view>{{item.score}}分换人</view>
        <view>A队：{{item.outA}} 下，{{item.inA}} 上 -> {{item.nextA[0]}} + {{item.nextA[1]}}</view>
        <view>B队：{{item.outB}} 下，{{item.inB}} 上 -> {{item.nextB[0]}} + {{item.nextB[1]}}</view>
      </view>
    </view>

    <view class="score-toolbar card">
      <text class="score-tip">点击比分可以修改</text>
      <view class="score-actions">
        <button class="toolbar-btn print-btn" bindtap="handlePrint">打印</button>
        <button class="toolbar-btn share-btn" bindtap="handleShare">转发</button>
      </view>
    </view>

    <view class="card score-card" wx:for="{{scoreMatches}}" wx:key="id">
      <view class="seg-title">{{item.title}}</view>
      <view class="score-line">
        <view class="team-col">
          <text class="player-tag">{{item.team1[0]}}</text>
          <text class="player-tag">{{item.team1[1]}}</text>
        </view>
        <view class="score-center">
          <input class="score-input" type="number" data-index="{{index}}" data-team="1" value="{{item.score1}}" bindinput="onScoreInput" />
          <text class="vs-big">VS</text>
          <input class="score-input" type="number" data-index="{{index}}" data-team="2" value="{{item.score2}}" bindinput="onScoreInput" />
        </view>
        <view class="team-col">
          <text class="player-tag">{{item.team2[0]}}</text>
          <text class="player-tag">{{item.team2[1]}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="settlement" wx:if="{{resultReady}}">
    <view class="section-title">结算（已录入{{totalScoredMatches}}段）</view>
    <view class="card summary">
      <text>A队总分：{{teamScoreSummary.teamA}}</text>
      <text>B队总分：{{teamScoreSummary.teamB}}</text>
    </view>
    <view class="card rank-card">
      <view class="rank-header">
        <text>名次</text>
        <text>选手</text>
        <text>胜场</text>
        <text>净胜</text>
        <text>胜率</text>
      </view>
      <view class="rank-row" wx:for="{{ranking}}" wx:key="name">
        <text>{{index + 1}}</text>
        <text>{{item.name}}</text>
        <text>{{item.wins}}</text>
        <text>{{item.diff}}</text>
        <text>{{item.winRate}}%</text>
      </view>
    </view>
  </view>

  <view class="bottom-safe"></view>
  <view class="fixed-footer">
    <button class="generate-btn" bindtap="onPrimaryAction">{{segments.length > 0 ? '结束比赛' : '生成无与伦比接力表'}}</button>
  </view>
</view>
