<view class="page">
  <view class="section-title">æ— ä¸ä¼¦æ¯”è§„åˆ™</view>
  <view class="card rule-card">
    <text>å¼€å±€ï¼š1å·+2å·ä¸Šåœºï¼Œä» 0:0 å¼€å§‹</text>
    <text>æ¥åŠ›ï¼šåˆ°è¾¾ Kã€2Kã€3K...N*K åˆ†æ—¶ï¼ŒåŒæ–¹åŒæ—¶æ¢äºº</text>
    <text>æ¢äººæ¨¡å¼ï¼šå½“å‰ç»„åˆå‰è€…ä¸‹ï¼Œä¸‹ä¸€ä½ä¸Šï¼›å½¢æˆè¿ç»­åŒäººç»„åˆ</text>
  </view>

  <view class="section-title">å‚æ•°è®¾ç½®</view>
  <view class="card config-card">
    <view class="config-row">
      <text class="label">æ¯é˜Ÿäººæ•° N</text>
      <view class="stepper">
        <button class="step-btn" bindtap="decreaseTeamSize">-</button>
        <text class="step-value">{{teamSize}}</text>
        <button class="step-btn" bindtap="increaseTeamSize">+</button>
      </view>
    </view>

    <view class="config-row">
      <text class="label">æ¯æ®µåˆ†å€¼ K</text>
      <view class="score-options">
        <view class="option {{scoreStep === 10 ? 'active' : ''}}" data-value="10" bindtap="selectScoreStep">10åˆ†åˆ¶</view>
        <view class="option {{scoreStep === 15 ? 'active' : ''}}" data-value="15" bindtap="selectScoreStep">15åˆ†åˆ¶</view>
      </view>
    </view>
  </view>

  <view class="section-title">é˜Ÿä¼é¡ºåºï¼ˆå¯é€‰ï¼‰</view>
  <view class="card input-card">
    <text class="hint">æ¯é˜Ÿè¯·è¾“å…¥ {{teamSize}} äººï¼ŒæŒ‰ 1-N é¡ºåºã€‚ç•™ç©ºå°†ç”¨ A1..AN / B1..BN é»˜è®¤ç¼–å·ã€‚</text>

    <text class="input-label">Aé˜Ÿåå•</text>
    <textarea class="textarea" placeholder="ç¤ºä¾‹ï¼šå¼ ä¸‰ æå›› ç‹äº”..." value="{{teamAInput}}" bindinput="onTeamAInput"></textarea>

    <text class="input-label">Bé˜Ÿåå•</text>
    <textarea class="textarea" placeholder="ç¤ºä¾‹ï¼šèµµä¸€ é’±äºŒ å­™ä¸‰..." value="{{teamBInput}}" bindinput="onTeamBInput"></textarea>
  </view>

  <view class="error" wx:if="{{errorText}}">{{errorText}}</view>

  <view class="result" wx:if="{{segments.length > 0}}">
    <view class="section-title">æ¥åŠ›æ’è¡¨</view>
    <view class="card summary">
      <text>æ¯é˜Ÿäººæ•°ï¼š{{summary.teamSize}}</text>
      <text>æ¯æ®µåˆ†å€¼ï¼š{{summary.scoreStep}}</text>
      <text>ç›®æ ‡åˆ†å€¼ï¼š{{summary.targetScore}}</text>
      <text>æ¥åŠ›æ®µæ•°ï¼š{{segments.length}}</text>
    </view>

    <view class="card segment-card" wx:for="{{segments}}" wx:key="id">
      <view class="seg-title">ç¬¬{{item.id}}æ®µï¼ˆ{{item.from}} - {{item.to}}åˆ†ï¼‰</view>
      <view class="seg-line">Aé˜Ÿï¼š{{item.pairA[0]}} + {{item.pairA[1]}}</view>
      <view class="seg-line">Bé˜Ÿï¼š{{item.pairB[0]}} + {{item.pairB[1]}}</view>
    </view>

    <view class="card swap-card" wx:if="{{swaps.length > 0}}">
      <view class="swap-title">æ¢äººèŠ‚ç‚¹</view>
      <view class="swap-item" wx:for="{{swaps}}" wx:key="score">
        <view>{{item.score}}åˆ†æ¢äºº</view>
        <view>Aé˜Ÿï¼š{{item.outA}} ä¸‹ï¼Œ{{item.inA}} ä¸Š -> {{item.nextA[0]}} + {{item.nextA[1]}}</view>
        <view>Bé˜Ÿï¼š{{item.outB}} ä¸‹ï¼Œ{{item.inB}} ä¸Š -> {{item.nextB[0]}} + {{item.nextB[1]}}</view>
      </view>
    </view>

    <view class="score-toolbar card">
      <text class="score-tip">ç‚¹å‡»æ¯”åˆ†å¯ä»¥ä¿®æ”¹</text>
      <view class="score-actions">
        <button class="toolbar-btn print-btn" bindtap="handlePrint">æ‰“å°</button>
        <button class="toolbar-btn share-btn" open-type="share">è½¬å‘</button>
      </view>
    </view>

    <view class="card score-card" wx:for="{{scoreMatches}}" wx:key="id">
      <view class="seg-title">{{item.title}}</view>
      <view class="score-line">
        <view class="team-col">
          <text class="player-tag">{{item.team1[0]}}</text>
          <text class="player-tag">{{item.team1[1]}}</text>
        </view>
        <view class="score-center">
          <input class="score-input" type="number" data-index="{{index}}" data-team="1" value="{{item.score1}}" bindinput="onScoreInput" />
          <text class="vs-big">VS</text>
          <input class="score-input" type="number" data-index="{{index}}" data-team="2" value="{{item.score2}}" bindinput="onScoreInput" />
        </view>
        <view class="team-col">
          <text class="player-tag">{{item.team2[0]}}</text>
          <text class="player-tag">{{item.team2[1]}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="settlement" wx:if="{{resultReady}}">
    <view class="section-title">ç»“ç®—ï¼ˆå·²å½•å…¥{{totalScoredMatches}}æ®µï¼‰</view>
    <view class="card summary">
      <text>Aé˜Ÿæ€»åˆ†ï¼š{{teamScoreSummary.teamA}}</text>
      <text>Bé˜Ÿæ€»åˆ†ï¼š{{teamScoreSummary.teamB}}</text>
    </view>
    <view class="card rank-card">
      <view class="rank-header">
        <text class="rank-col rank-col-rank">æ’å</text>
        <text class="rank-col rank-col-name">é€‰æ‰‹</text>
        <text class="rank-col">èƒœåœº</text>
        <text class="rank-col">å‡€èƒœ</text>
        <text class="rank-col">èƒœç‡</text>
      </view>
      <view class="rank-row {{index === 0 ? 'rank-top1' : (index === 1 ? 'rank-top2' : (index === 2 ? 'rank-top3' : ''))}}" wx:for="{{ranking}}" wx:key="name">
        <view class="rank-col rank-col-rank rank-rank-wrap">
          <text class="medal" wx:if="{{index === 0}}">ğŸ¥‡</text>
          <text class="medal" wx:if="{{index === 1}}">ğŸ¥ˆ</text>
          <text class="medal" wx:if="{{index === 2}}">ğŸ¥‰</text>
          <text class="rank-no">{{index + 1}}</text>
        </view>
        <text class="rank-col rank-col-name">{{item.name}}</text>
        <text class="rank-col rank-num">{{item.wins}}</text>
        <text class="rank-col rank-num">{{item.diff}}</text>
        <text class="rank-col rank-num">{{item.winRate}}%</text>
      </view>
    </view>
  </view>

  <view class="bottom-safe"></view>
  <view class="fixed-footer">
    <button class="generate-btn" bindtap="onPrimaryAction">{{segments.length > 0 ? 'ç»“æŸæ¯”èµ›' : 'ç”Ÿæˆæ— ä¸ä¼¦æ¯”æ¥åŠ›è¡¨'}}</button>
  </view>
</view>
